name: Object Filter with Array Manipulation

on:
  push:
    branches:
      - main

jobs:
  object-filter-demo:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Define Objects
        id: define_objects
        run: |
          objects='[
            {"name": "Object1", "status": "active"},
            {"name": "Object2", "status": "inactive"},
            {"name": "Object3", "status": "active"}
          ]'
          echo "::set-output name=objects::$objects"

      - name: Filter Active Objects
        id: filter_active
        run: |
          active_objects="${{ steps.define_objects.outputs.objects }}"
          # Use fromJson and filter the active objects based on status
          filtered_objects=$(echo $active_objects | jq '[.[] | select(.status == "active")]')
          echo "::set-output name=active_objects::$filtered_objects"

      - name: Display Filtered Active Objects
        run: |
          echo "Filtered Active Objects: ${{ steps.filter_active.outputs.active_objects }}"
